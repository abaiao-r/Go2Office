@startuml settings-update
!theme plain
title Update Settings and Recalculate

actor User
participant "Settings\nScreen" as Screen
participant "Settings\nViewModel" as VM
participant "Save Settings\nUseCase" as SaveUC
participant "Repository" as Repo
participant "Room\nDatabase" as DB
participant "Dashboard\nViewModel" as DashVM

User -> Screen : Open Settings
activate Screen
Screen -> VM : Load current settings
activate VM
VM -> Repo : getSettings()
activate Repo
Repo -> DB : SELECT settings
DB --> Repo : Current settings
Repo --> VM : OfficeSettings\n(3 days/week)
deactivate Repo
VM --> Screen : Display current
Screen --> User : Show: 3 days/week

User -> Screen : Change to 4 days/week
User -> Screen : Tap "Save"
Screen -> VM : onEvent(UpdateSettings\n(4 days/week))

VM -> VM : Validate:\n- Days 1-5 ✓\n- Hours 1-12 ✓

VM -> SaveUC : execute(newSettings)
activate SaveUC
SaveUC -> Repo : saveSettings\n(4 days/week)
activate Repo
Repo -> DB : UPDATE settings
activate DB
DB --> Repo : Updated
deactivate DB
Repo --> SaveUC : Success
deactivate Repo
SaveUC --> VM : Result.success
deactivate SaveUC

VM -> VM : Update state\n(saved = true)
VM --> Screen : Show "Saved ✓"
deactivate VM
Screen --> User : Settings updated

== Dashboard Auto-Recalculates ==

DB -> Repo : Settings changed\n(Flow emits)
activate Repo
Repo -> DashVM : Flow<Settings>
activate DashVM

DashVM -> DashVM : observeSettings() {\n  loadDashboardData()\n}

note over DashVM
Dashboard ViewModel
observes settings Flow
and reloads data when
settings change
end note

DashVM -> DashVM : Recalculate:\n- Requirements\n- Suggestions

DashVM --> Repo : New state ready
deactivate DashVM
deactivate Repo

note over User
Next time user opens
Dashboard, new requirements
are automatically shown
end note

deactivate Screen

@enduml

